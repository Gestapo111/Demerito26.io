<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instrumento No. 001 - Oficial</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f4f6f9}
header{background:#003366;color:white;text-align:center;padding:15px}
.container{width:98%;margin:15px auto;background:white;padding:15px;border-radius:6px}
input,select{width:100%;padding:4px;font-size:12px}
table{width:100%;border-collapse:collapse;font-size:11px;margin-top:10px}
th,td{border:1px solid #000;padding:3px;text-align:center}
th{background:#ddd}
textarea{width:100%;height:40px;font-size:11px}
.total-box{font-weight:bold;padding:8px;margin-top:8px}
.alerta{padding:8px;margin-top:5px;font-weight:bold}
.verde{background:#d4edda}
.amarillo{background:#fff3cd}
.naranja{background:#ffe0b2}
.rojo{background:#f8d7da}
button{margin-top:10px;padding:8px 15px;background:#003366;color:white;border:none}
</style>
</head>

<body>

<header>
<h2>Instrumento No. 001</h2>
<h3>Tarjeta de Deméritos del Estudiante</h3>
</header>

<div class="container" id="contenidoPDF">

<!-- ENCABEZADO COMPLETO -->
<table>
<tr>
<td>1. Nombre del Centro Educativo</td>
<td colspan="3"><input></td>
<td>2. Código C.E.</td>
<td><input></td>
</tr>
<tr>
<td>3. Departamento</td><td><input></td>
<td>4. Municipio</td><td><input></td>
<td>5. Distrito</td><td><input></td>
</tr>
<tr>
<td>6. Nombre del Estudiante</td>
<td colspan="3"><input></td>
<td>7. NIE</td>
<td><input></td>
</tr>
<tr>
<td>8. Sexo</td>
<td>
<select>
<option></option>
<option>Mujer</option>
<option>Hombre</option>
</select>
</td>
<td>9. Grado/Sección</td><td><input></td>
<td>10. Turno</td>
<td>
<select>
<option></option>
<option>Matutino</option>
<option>Vespertino</option>
<option>Nocturno</option>
</select>
</td>
</tr>
</table>

<!-- TABLA OFICIAL -->
<table>
<tr>
<th>No.</th>
<th>11.Fecha</th>
<th colspan="4">12.D</th>
<th colspan="3">
}

#totalBox{
    margin-top:15px;
    padding:10px;
    font-weight:bold;
    border-radius:6px;
}

.alerta{
    margin-top:10px;
    padding:10px;
    border-radius:6px;
    font-weight:bold;
}

.verde{background:#d4edda;color:#155724;}
.amarillo{background:#fff3cd;color:#856404;}
.naranja{background:#ffe0b2;color:#8a4b00;}
.rojo{background:#f8d7da;color:#721c24;}
</style>
</head>

<body>

<header>
<h2>Instrumento No. 001</h2>
<h1>Tarjeta de Deméritos del Estudiante</h1>
</header>

<div class="container" id="contenidoPDF">

<h3>Datos Generales</h3>

<div class="grid">
<div>
<input placeholder="Centro Educativo">
<input placeholder="Nombre del Estudiante">
</div>
<div>
<input placeholder="Grado / Sección">
<input placeholder="NIE">
</div>
</div>

<h3>Registro</h3>

<table>
<tr>
<th>No.</th>
<th>Fecha</th>
<th>D-A</th>
<th>D-B</th>
<th>D-C</th>
<th>D-D</th>
<th>R-A</th>
<th>R-B</th>
<th>R-C</th>
</tr>

<tbody id="tabla"></tbody>
</table>

<div id="totalBox" class="verde">
Total Actual de Deméritos: <span id="total">0</span>
</div>

<div id="alerta"></div>

</div>

<div style="text-align:center">
<button onclick="generarPDF()">Guardar en PDF</button>
</div>

<script>

for(let i=1;i<=8;i++){
    document.getElementById("tabla").innerHTML += `
    <tr>
        <td>${i}</td>
        <td><input type="date"></td>
        <td><input type="checkbox" class="demerito"></td>
        <td><input type="checkbox" class="demerito"></td>
        <td><input type="checkbox" class="demerito"></td>
        <td><input type="checkbox" class="demerito"></td>
        <td><input type="checkbox" class="redencion"></td>
        <td><input type="checkbox" class="redencion"></td>
        <td><input type="checkbox" class="redencion"></td>
    </tr>
    `;
}

document.addEventListener("change", calcularTotal);

function calcularTotal(){
    let demeritos = document.querySelectorAll(".demerito:checked").length;
    let redenciones = document.querySelectorAll(".redencion:checked").length;

    let total = demeritos - redenciones;
    if(total < 0) total = 0;

    document.getElementById("total").innerText = total;

    let alerta = document.getElementById("alerta");
    let totalBox = document.getElementById("totalBox");

    alerta.innerHTML = "";
    totalBox.className = "";

    if(total >= 15){
        alerta.innerHTML = "⚠ 15 DEMÉRITOS: No promoción de grado.";
        alerta.className = "alerta rojo";
        totalBox.className = "rojo";
    }
    else if(total >= 10){
        alerta.innerHTML = "⚠ 10 DEMÉRITOS: Suspensión de privilegios.";
        alerta.className = "alerta naranja";
        totalBox.className = "naranja";
    }
    else if(total >= 6){
        alerta.innerHTML = "⚠ 6 DEMÉRITOS: Comunicación a la familia.";
        alerta.className = "alerta amarillo";
        totalBox.className = "amarillo";
    }
    else if(total >= 3){
        alerta.innerHTML = "⚠ 3 DEMÉRITOS: Advertencia verbal.";
        alerta.className = "alerta amarillo";
        totalBox.className = "amarillo";
    }
    else{
        totalBox.className = "verde";
    }
}

async function generarPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p','pt','a4');

    await doc.html(document.querySelector("#contenidoPDF"), {
        callback: function (doc) {
            doc.save("Tarjeta_Demeritos.pdf");
        },
        margin: 20
    });
}

</script>

</body>
</html>

