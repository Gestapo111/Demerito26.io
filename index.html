<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instrumento No. 001 ‚Äî Tarjeta de Dem√©ritos</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root {
  --navy:    #0d1f3c;
  --navy2:   #162d52;
  --gold:    #c8a84b;
  --gold-lt: #e8c96a;
  --cream:   #f9f6f0;
  --red:     #c0392b;
  --orange:  #d35400;
  --green:   #1e8449;
  --muted:   #8a99b0;
  --border:  #dce3ed;
  --radius:  6px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--navy);
  background-image: radial-gradient(ellipse at 20% 0%,#1e3a6e55 0%,transparent 60%), radial-gradient(ellipse at 80% 100%,#c8a84b22 0%,transparent 60%);
  min-height: 100vh;
  padding: 24px 16px 40px;
  color: #222;
}

/* TOOLBAR */
.toolbar { max-width: 900px; margin: 0 auto 18px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.toolbar h1 { font-family: 'DM Serif Display', serif; color: var(--gold-lt); font-size: 20px; flex: 1; letter-spacing: .02em; }
.btn { display: inline-flex; align-items: center; gap: 7px; padding: 9px 18px; border: none; border-radius: 50px; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; cursor: pointer; transition: transform .15s, box-shadow .15s; white-space: nowrap; }
.btn:hover  { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,0,0,.25); }
.btn:active { transform: translateY(0); }
.btn:disabled { opacity: .55; pointer-events: none; }
.btn-pdf   { background: var(--gold); color: var(--navy); }
.btn-print { background: #2c3e50; color: #fff; }
.btn-add   { background: var(--green); color: #fff; }
.btn-clear { background: var(--red); color: #fff; }

/* DOCUMENTO */
.documento { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,.35); overflow: hidden; }

/* HEADER */
.header { background: var(--navy); padding: 24px 32px; display: grid; grid-template-columns: 72px 1fr 72px; align-items: center; gap: 16px; border-bottom: 4px solid var(--gold); }
.logo-circle { width: 72px; height: 72px; border-radius: 50%; background: rgba(255,255,255,.08); border: 2px solid var(--gold); display: flex; align-items: center; justify-content: center; font-size: 10px; color: var(--gold); text-align: center; font-weight: 600; }
.header-center { text-align: center; }
.header-center h2 { font-family: 'DM Serif Display', serif; color: #fff; font-size: 26px; letter-spacing: .03em; line-height: 1.2; }
.header-center .sub { color: var(--gold-lt); font-size: 13px; font-weight: 500; margin-top: 4px; letter-spacing: .05em; text-transform: uppercase; }

/* DOC BODY */
.doc-body { padding: 28px 32px; }

/* SECCIONES */
.section { margin-bottom: 22px; }
.section-title { display: flex; align-items: center; gap: 8px; background: var(--navy); color: #fff; padding: 7px 14px; border-radius: var(--radius); font-size: 12px; font-weight: 700; letter-spacing: .06em; text-transform: uppercase; margin-bottom: 10px; }
.section-title span { font-size: 15px; }

/* INFO GRID */
.info-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap: 12px; }
.field { display: flex; flex-direction: column; gap: 3px; }
.field.wide { grid-column: span 2; }
.field label { font-size: 10px; font-weight: 700; color: var(--muted); letter-spacing: .07em; text-transform: uppercase; }
.field input, .field select { border: 1.5px solid var(--border); border-radius: var(--radius); padding: 7px 10px; font-family: 'DM Sans', sans-serif; font-size: 13px; color: var(--navy); background: var(--cream); transition: border-color .15s, background .15s; width: 100%; }
.field input:focus, .field select:focus { outline: none; border-color: var(--gold); background: #fff; box-shadow: 0 0 0 3px rgba(200,168,75,.15); }
.field input[readonly] { background: #f0f2f5; color: #555; cursor: default; }
.input-with-btn { display: flex; gap: 6px; align-items: center; }
.input-with-btn input { flex: 1; }
.btn-select { flex-shrink: 0; padding: 7px 12px; background: var(--navy); color: var(--gold-lt); border: none; border-radius: var(--radius); font-size: 12px; font-weight: 700; cursor: pointer; white-space: nowrap; transition: background .15s; letter-spacing: .03em; }
.btn-select:hover { background: var(--navy2); }

/* LEYENDA */
.legend { display: flex; gap: 20px; flex-wrap: wrap; background: #f4f7fb; border: 1.5px solid var(--border); border-radius: var(--radius); padding: 10px 16px; font-size: 11.5px; margin-bottom: 22px; }
.legend strong { color: var(--navy); margin-right: 4px; }
.badge { display: inline-flex; align-items: center; gap: 5px; padding: 2px 8px; border-radius: 50px; font-size: 11px; font-weight: 700; }
.badge-dem { background: #fce8e6; color: var(--red); }
.badge-red { background: #e8f4fd; color: #1a73b9; }
.badge-rec { background: #e6f9ed; color: var(--green); }

/* TABLA */
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; font-size: 11px; }
thead tr:first-child th { background: var(--navy2); color: #fff; padding: 8px 6px; font-weight: 700; letter-spacing: .04em; font-size: 10.5px; }
thead tr:nth-child(2) th { background: #e8ecf5; color: var(--navy); font-weight: 700; padding: 6px 4px; }
thead tr:nth-child(2) th.th-dem { background: #fce8e6; color: var(--red); }
thead tr:nth-child(2) th.th-red { background: #e0eefc; color: #1a73b9; }
thead tr:nth-child(2) th.th-rec { background: #e2f5e9; color: var(--green); }
tbody tr { transition: background .1s; }
tbody tr:nth-child(even) { background: #f9fafc; }
tbody tr:hover { background: #f0f5ff; }
td { border: 1px solid #dce3ed; padding: 4px; vertical-align: middle; text-align: center; }
td.num { font-weight: 700; color: var(--muted); width: 28px; }
td input[type="date"] { border: 1.5px solid var(--border); border-radius: 4px; padding: 3px 4px; font-size: 10.5px; font-family: inherit; background: var(--cream); color: var(--navy); width: 115px; transition: border-color .15s; }
td input[type="date"]:focus { outline: none; border-color: var(--gold); }
td input[type="checkbox"] { width: 16px; height: 16px; cursor: pointer; accent-color: var(--navy); }
td.check-dem input[type="checkbox"] { accent-color: var(--red); }
td.check-red input[type="checkbox"] { accent-color: #1a73b9; }
td.check-rec input[type="checkbox"] { accent-color: var(--green); }
td textarea, td input[type="text"].inline { border: 1px solid var(--border); border-radius: 4px; padding: 3px 5px; font-size: 10.5px; font-family: inherit; background: transparent; resize: none; width: 100%; min-height: 32px; transition: border-color .15s, background .15s; }
td textarea:focus, td input[type="text"].inline:focus { outline: none; border-color: var(--gold); background: #fffdf5; }
td.desc textarea { min-height: 36px; width: 130px; }
td.del-cell button { background: none; border: none; color: #ccc; font-size: 15px; cursor: pointer; padding: 2px 4px; border-radius: 4px; transition: color .15s, background .15s; line-height: 1; }
td.del-cell button:hover { color: var(--red); background: #fce8e6; }

/* PROGRESO */
.progress-wrap { margin: 0 0 22px; }
.progress-label { display: flex; justify-content: space-between; font-size: 11px; font-weight: 600; color: var(--muted); margin-bottom: 5px; }
.progress-bar-bg { background: #e8ecf5; border-radius: 50px; height: 10px; overflow: hidden; }
.progress-bar { height: 100%; border-radius: 50px; transition: width .4s, background .4s; }

/* RESUMEN */
.summary { display: grid; grid-template-columns: repeat(auto-fit,minmax(160px,1fr)); gap: 14px; margin: 22px 0; }
.stat-card { border-radius: 10px; padding: 16px 18px; text-align: center; position: relative; overflow: hidden; transition: transform .2s; }
.stat-card:hover { transform: translateY(-2px); }
.stat-card::before { content:''; position:absolute; inset:0; opacity:.07; background: repeating-linear-gradient(45deg,#fff 0,#fff 2px,transparent 2px,transparent 8px); }
.stat-card .val { font-family: 'DM Serif Display',serif; font-size: 42px; line-height: 1; }
.stat-card .lbl { font-size: 11.5px; font-weight: 600; margin-top: 4px; letter-spacing: .04em; text-transform: uppercase; opacity: .85; }
.stat-dem { background: #fce8e6; color: var(--red); }
.stat-red { background: #e0eefc; color: #1a73b9; }
.stat-net { background: var(--navy); color: #fff; }
.stat-rec { background: #e2f5e9; color: var(--green); }

/* SANCI√ìN */
.sanction { border-radius: 10px; padding: 14px 20px; display: flex; align-items: center; gap: 12px; margin-bottom: 22px; font-weight: 600; font-size: 14px; transition: background .4s,color .4s; }
.sanction-icon { font-size: 26px; flex-shrink: 0; }
.sanction-text { line-height: 1.4; }
.sanction-text small { display: block; font-size: 11px; font-weight: 400; opacity: .75; margin-top: 2px; }
.s-none   { background: #e6f9ed; color: var(--green); }
.s-warn   { background: #fef9e7; color: #b7950b; }
.s-comms  { background: #fef2e0; color: var(--orange); }
.s-susp   { background: #fce8e6; color: var(--red); }
.s-noprom { background: var(--red); color: #fff; }

/* FIRMA */
.firma-section { margin-top: 30px; padding-top: 20px; border-top: 1.5px solid var(--border); display: flex; justify-content: center; }
.firma-box { text-align: center; min-width: 280px; }
.firma-line { border-top: 2px solid var(--navy); padding-top: 8px; font-size: 11.5px; font-weight: 600; color: var(--navy); }

/* MODAL ESTUDIANTE */
.modal-overlay { position: fixed; inset: 0; background: rgba(10,20,40,.65); backdrop-filter: blur(4px); z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity .2s; }
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal { background: #fff; border-radius: 14px; width: 520px; max-width: 95vw; max-height: 80vh; display: flex; flex-direction: column; box-shadow: 0 24px 64px rgba(0,0,0,.4); transform: translateY(18px) scale(.97); transition: transform .22s cubic-bezier(.34,1.56,.64,1); overflow: hidden; }
.modal-overlay.open .modal { transform: translateY(0) scale(1); }
.modal-header { background: var(--navy); padding: 18px 22px; display: flex; align-items: center; justify-content: space-between; border-bottom: 3px solid var(--gold); flex-shrink: 0; }
.modal-header h3 { font-family: 'DM Serif Display',serif; color: #fff; font-size: 18px; letter-spacing: .02em; }
.modal-header p  { color: var(--gold-lt); font-size: 11.5px; margin-top: 2px; }
.modal-close { background: rgba(255,255,255,.12); border: none; color: #fff; font-size: 18px; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background .15s; flex-shrink: 0; }
.modal-close:hover { background: rgba(255,255,255,.25); }
.modal-search-wrap { padding: 14px 18px 10px; flex-shrink: 0; border-bottom: 1.5px solid var(--border); }
.modal-search { width: 100%; border: 1.5px solid var(--border); border-radius: 50px; padding: 9px 16px 9px 38px; font-family: 'DM Sans',sans-serif; font-size: 13px; color: var(--navy); background: var(--cream) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%238a99b0' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='M21 21l-4.35-4.35'/%3E%3C/svg%3E") no-repeat 13px center; transition: border-color .15s, box-shadow .15s; }
.modal-search:focus { outline: none; border-color: var(--gold); box-shadow: 0 0 0 3px rgba(200,168,75,.15); background-color: #fff; }
.modal-list { overflow-y: auto; flex: 1; padding: 8px 10px; }
.modal-item { display: flex; align-items: center; gap: 14px; padding: 10px 12px; border-radius: 8px; cursor: pointer; transition: background .12s; border: 1.5px solid transparent; }
.modal-item:hover    { background: #f0f5ff; border-color: #c8d8f8; }
.modal-item.selected { background: #e8f0fe; border-color: var(--gold); }
.modal-num { width: 26px; height: 26px; border-radius: 50%; background: var(--navy); color: #fff; font-size: 11px; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.modal-info { flex: 1; }
.modal-info .est-name { font-size: 13px; font-weight: 600; color: var(--navy); letter-spacing: .01em; }
.modal-info .est-nie  { font-size: 11px; color: var(--muted); margin-top: 1px; }
.modal-no-results { text-align: center; color: var(--muted); font-size: 13px; padding: 30px 0; }

/* MODALES CONFIRMACI√ìN */
.confirm-overlay { position: fixed; inset: 0; background: rgba(10,20,40,.55); backdrop-filter: blur(3px); z-index: 1100; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity .2s; }
.confirm-overlay.open { opacity: 1; pointer-events: all; }
.confirm-box { background: #fff; border-radius: 14px; width: 420px; max-width: 94vw; box-shadow: 0 24px 64px rgba(0,0,0,.35); overflow: hidden; transform: scale(.93) translateY(16px); transition: transform .22s cubic-bezier(.34,1.56,.64,1); }
.confirm-overlay.open .confirm-box { transform: scale(1) translateY(0); }
.confirm-header { padding: 18px 22px 14px; border-bottom: 3px solid; }
.confirm-header.red-theme { background: #1a6fa0; border-color: #4fb3e8; }
.confirm-header.rec-theme { background: #1a7a3e; border-color: #4cca7a; }
.confirm-header h3 { font-family: 'DM Serif Display',serif; color: #fff; font-size: 17px; }
.confirm-header p  { color: rgba(255,255,255,.75); font-size: 11.5px; margin-top: 3px; }
.confirm-body { padding: 20px 22px; }
.confirm-item { display: flex; align-items: flex-start; gap: 12px; padding: 12px 14px; border-radius: 8px; margin-bottom: 8px; border: 1.5px solid var(--border); background: #f8fafd; }
.confirm-letter { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 13px; flex-shrink: 0; margin-top: 1px; }
.red-theme-letter { background: #1a6fa0; color: #fff; }
.rec-theme-letter { background: #1a7a3e; color: #fff; }
.confirm-item-text { font-size: 13px; color: var(--navy); line-height: 1.5; }
.confirm-footer { padding: 14px 22px 18px; display: flex; gap: 10px; justify-content: flex-end; border-top: 1.5px solid var(--border); }
.btn-cancel-c { padding: 8px 20px; border: 1.5px solid var(--border); border-radius: 50px; background: #fff; color: var(--muted); font-family: 'DM Sans',sans-serif; font-size: 13px; font-weight: 600; cursor: pointer; transition: background .15s; }
.btn-cancel-c:hover { background: #f0f2f5; }
.btn-confirm-red { padding: 8px 22px; border: none; border-radius: 50px; background: #1a6fa0; color: #fff; font-family: 'DM Sans',sans-serif; font-size: 13px; font-weight: 700; cursor: pointer; transition: background .15s; }
.btn-confirm-red:hover { background: #145a84; }
.btn-confirm-rec { padding: 8px 22px; border: none; border-radius: 50px; background: #1a7a3e; color: #fff; font-family: 'DM Sans',sans-serif; font-size: 13px; font-weight: 700; cursor: pointer; transition: background .15s; }
.btn-confirm-rec:hover { background: #145a2e; }

/* PRINT */
@media print {
  body { background: #fff; padding: 0; }
  .toolbar { display: none; }
  .documento { max-width: 100%; box-shadow: none; border-radius: 0; }
  .btn { display: none; }
  .del-cell { display: none; }
  td input[type="date"] { width: auto; }
}

/* RESPONSIVE */
@media (max-width: 600px) {
  .doc-body { padding: 16px; }
  .header   { padding: 16px; }
  .field.wide { grid-column: span 1; }
}
</style>
</head>
<body>

<!-- TOOLBAR -->
<div class="toolbar">
  <h1>Tarjeta de Dem√©ritos</h1>
  <button class="btn btn-add"   onclick="agregarFila()">‚ûï Agregar fila</button>
  <button class="btn btn-pdf"   id="btnPDF" onclick="exportarPDF()">üíæ Guardar PDF</button>
  <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Imprimir</button>
  <button class="btn btn-clear" onclick="limpiarFormulario()">üóëÔ∏è Limpiar</button>
</div>

<!-- DOCUMENTO -->
<div class="documento" id="contenidoPDF">
  <div class="header">
    <div class="logo-circle">Logo<br>C.E.</div>
    <div class="header-center">
      <h2>Instrumento No. 001</h2>
      <div class="sub">Tarjeta de Dem√©ritos del Estudiante</div>
    </div>
    <div class="logo-circle">Escudo<br>Inst.</div>
  </div>

  <div class="doc-body">

    <!-- CENTRO EDUCATIVO -->
    <div class="section">
      <div class="section-title"><span>üìã</span> Informaci√≥n del Centro Educativo</div>
      <div class="info-grid">
        <div class="field wide"><label>Centro Educativo</label><input type="text" value="COMPLEJO EDUCATIVO CANT√ìN SAN ISIDRO" readonly></div>
        <div class="field"><label>C√≥digo</label><input type="text" value="70056" readonly></div>
        <div class="field"><label>Departamento</label><input type="text" value="SAN SALVADOR" readonly></div>
        <div class="field"><label>Municipio</label><input type="text" value="PANCHIMALCO" readonly></div>
        <div class="field"><label>Distrito</label><input type="text" value="06-14" readonly></div>
      </div>
    </div>

    <!-- ESTUDIANTE -->
    <div class="section">
      <div class="section-title"><span>üë§</span> Informaci√≥n del Estudiante</div>
      <div class="info-grid">
        <div class="field wide">
          <label>Nombre completo</label>
          <div class="input-with-btn">
            <input type="text" id="nombreEstudiante" placeholder="Seleccione de la lista" autocomplete="off" readonly style="cursor:default;">
            <button class="btn-select" onclick="abrirModal()">üë• Seleccionar</button>
          </div>
        </div>
        <div class="field"><label>NIE</label><input type="text" id="nie" placeholder="N√∫mero de IE"></div>
        <div class="field">
          <label>Sexo</label>
          <select id="sexo"><option value="">Seleccione</option><option>Mujer</option><option>Hombre</option></select>
        </div>
        <div class="field"><label>Grado / Secci√≥n</label><input type="text" id="grado" placeholder="Ej: 9¬∞A"></div>
        <div class="field">
          <label>Turno</label>
          <select id="turno"><option value="">Seleccione</option><option>Matutino</option><option>Vespertino</option><option>Nocturno</option></select>
        </div>
        <div class="field"><label>A√±o lectivo</label><input type="text" id="anio" placeholder="Ej: 2025"></div>
      </div>
    </div>

    <!-- LEYENDA -->
    <div class="legend">
      <div><span class="badge badge-dem">D A‚ÄìD</span> <strong>Dem√©ritos</strong> ‚Äî Falta que suma puntos negativos</div>
      <div><span class="badge badge-red">R A‚ÄìC</span> <strong>Redenci√≥n</strong> ‚Äî Acci√≥n positiva que descuenta dem√©ritos</div>
      <div><span class="badge badge-rec">RC A‚ÄìB</span> <strong>Reconocimiento</strong> ‚Äî M√©rito destacado (no descuenta)</div>
    </div>

    <!-- TABLA -->
    <div class="section">
      <div class="section-title"><span>üìä</span> Registro de Dem√©ritos y Reconocimientos</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th rowspan="2">#</th>
              <th rowspan="2">Fecha</th>
              <th rowspan="2">Descripci√≥n de la falta / acci√≥n</th>
              <th colspan="4" style="background:#b03a2e;">Dem√©ritos (D)</th>
              <th colspan="3" style="background:#1a6fa0;">Redenci√≥n (R)</th>
              <th colspan="2" style="background:#1a7a3e;">Reconoc. (RC)</th>
              <th rowspan="2">Docente responsable</th>
              <th rowspan="2">Firma padre/madre</th>
              <th rowspan="2">Firma estudiante</th>
              <th rowspan="2" class="del-cell" style="width:28px;"></th>
            </tr>
            <tr>
              <th class="th-dem">A</th><th class="th-dem">B</th><th class="th-dem">C</th><th class="th-dem">D</th>
              <th class="th-red">A</th><th class="th-red">B</th><th class="th-red">C</th>
              <th class="th-rec">A</th><th class="th-rec">B</th>
            </tr>
          </thead>
          <tbody id="tabla"></tbody>
        </table>
      </div>
    </div>

    <!-- PROGRESO -->
    <div class="progress-wrap">
      <div class="progress-label"><span>Progreso de dem√©ritos netos</span><span id="progressLabel">0 / 15</span></div>
      <div class="progress-bar-bg"><div class="progress-bar" id="progressBar" style="width:0%;background:#27ae60;"></div></div>
    </div>

    <!-- RESUMEN -->
    <div class="summary">
      <div class="stat-card stat-dem"><div class="val" id="totalDem">0</div><div class="lbl">Dem√©ritos totales</div></div>
      <div class="stat-card stat-red"><div class="val" id="totalRed">0</div><div class="lbl">Redenciones</div></div>
      <div class="stat-card stat-net"><div class="val" id="totalNet">0</div><div class="lbl">Dem√©ritos netos</div></div>
      <div class="stat-card stat-rec"><div class="val" id="totalRec">0</div><div class="lbl">Reconocimientos</div></div>
    </div>

    <!-- SANCI√ìN -->
    <div class="sanction s-none" id="sancion">
      <div class="sanction-icon">‚úÖ</div>
      <div class="sanction-text">Sin sanci√≥n acumulada<small>0 dem√©ritos netos ‚Äî contin√∫e observando la conducta del estudiante</small></div>
    </div>

    <!-- FIRMA -->
    <div class="firma-section">
      <div class="firma-box">
        <div style="height:50px;"></div>
        <div class="firma-line">Nombre, firma y sello del Director(a) del C.E.</div>
      </div>
    </div>

  </div>
</div>

<!-- MODAL ESTUDIANTE -->
<div class="modal-overlay" id="modalOverlay" onclick="cerrarModalOverlay(event)">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div><h3>Seleccionar Estudiante</h3><p>Haga clic en un nombre para autocompletar el formulario</p></div>
      <button class="modal-close" onclick="cerrarModal()">‚úï</button>
    </div>
    <div class="modal-search-wrap">
      <input type="text" class="modal-search" id="modalSearch" placeholder="Buscar por nombre o NIE‚Ä¶" oninput="filtrarEstudiantes()" autocomplete="off">
    </div>
    <div class="modal-list" id="modalList"></div>
  </div>
</div>

<!-- MODAL CONFIRMACI√ìN REDENCI√ìN -->
<div class="confirm-overlay" id="confirmRedOverlay">
  <div class="confirm-box">
    <div class="confirm-header red-theme"><h3>‚úî Confirmar Redenci√≥n</h3><p>¬øDesea registrar la siguiente acci√≥n de redenci√≥n?</p></div>
    <div class="confirm-body" id="confirmRedBody"></div>
    <div class="confirm-footer">
      <button class="btn-cancel-c"    onclick="cancelarConfirm('red')">Cancelar</button>
      <button class="btn-confirm-red" onclick="aceptarConfirm('red')">‚úî Confirmar</button>
    </div>
  </div>
</div>

<!-- MODAL CONFIRMACI√ìN RECONOCIMIENTO -->
<div class="confirm-overlay" id="confirmRecOverlay">
  <div class="confirm-box">
    <div class="confirm-header rec-theme"><h3>üèÖ Confirmar Reconocimiento</h3><p>¬øDesea registrar el siguiente reconocimiento?</p></div>
    <div class="confirm-body" id="confirmRecBody"></div>
    <div class="confirm-footer">
      <button class="btn-cancel-c"    onclick="cancelarConfirm('rec')">Cancelar</button>
      <button class="btn-confirm-rec" onclick="aceptarConfirm('rec')">‚úî Confirmar</button>
    </div>
  </div>
</div>

<script>
/* ‚îÄ‚îÄ DATOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const ESTUDIANTES = [
  {no:1,  nie:'10192638', nombre:'ACOSTA DEODANES, CAROLINA LISSETH',    sexo:'Mujer'  },
  {no:2,  nie:'20085229', nombre:'AGUILAR ORTIZ, CESAR ISMAEL',          sexo:'Hombre' },
  {no:3,  nie:'20085270', nombre:'BENITEZ PEREZ, OSCAR EFRAIN',          sexo:'Hombre' },
  {no:4,  nie:'20085307', nombre:'CARRILLO VENTURA, RUTH NOEMY',         sexo:'Mujer'  },
  {no:5,  nie:'19933288', nombre:'CASTRO ORTIZ, JAZMIN SARAI',           sexo:'Mujer'  },
  {no:6,  nie:'20008551', nombre:'CORNEJO ORTIZ, PAMELA GUADALUPE',      sexo:'Mujer'  },
  {no:7,  nie:'19933292', nombre:'CRUZ GARC√çA, JHAMILTON GEOVANY',       sexo:'Hombre' },
  {no:8,  nie:'10380636', nombre:'CRUZ VEGA, JUANA ELENA',               sexo:'Mujer'  },
  {no:9,  nie:'20085334', nombre:'DEODANES JORGE, DAVID ALEXANDER',      sexo:'Hombre' },
  {no:10, nie:'20161320', nombre:'DEODANES P√âREZ, CARLOS DANIEL',        sexo:'Hombre' },
  {no:11, nie:'19933320', nombre:'DEODANES RODRIGUEZ, WILLIAN LEONEL',   sexo:'Hombre' },
  {no:12, nie:'20161321', nombre:'DEODANES SANTOS, KATHERIN MARITZA',    sexo:'Mujer'  },
  {no:13, nie:'20116603', nombre:'JORGE BENITEZ, XAVIER ERNESTO',        sexo:'Hombre' },
  {no:14, nie:'20116605', nombre:'LEON RODRIGUEZ, JEFFERSON ALEXIS',     sexo:'Hombre' },
  {no:15, nie:'20116607', nombre:'MARTINEZ PEREZ, MANUEL ENRIQUE',       sexo:'Hombre' },
  {no:16, nie:'20116608', nombre:'MARTINEZ VASQUEZ, ANDERSON MAURICIO',  sexo:'Hombre' },
  {no:17, nie:'20161327', nombre:'MART√çNEZ MIRANDA, JOS√â BRYAN',         sexo:'Hombre' },
  {no:18, nie:'20116614', nombre:'MENDEZ PEREZ, JORGE ERNESTO',          sexo:'Hombre' },
  {no:19, nie:'19964662', nombre:'ORTIZ MART√çNEZ, JOSELYN ROXANA',       sexo:'Mujer'  },
  {no:20, nie:'20116635', nombre:'PEREZ JACINTO, ROSIBEL',               sexo:'Mujer'  },
  {no:21, nie:'19964672', nombre:'P√âREZ DEODANES, ISA√çAS ARMANDO',       sexo:'Hombre' },
  {no:22, nie:'20116666', nombre:'VASQUEZ BENITES, DORIS ESTEFANNY',     sexo:'Mujer'  },
  {no:23, nie:'20116669', nombre:'VASQUEZ MARTINEZ, NELSON ANTONIO',     sexo:'Hombre' },
  {no:24, nie:'20116683', nombre:'VENITES RODRIGUEZ, SERGIO JAVIER',     sexo:'Hombre' },
];

const SANCIONES = [
  {min:15, cls:'s-noprom', icon:'üö´', titulo:'No promoci√≥n de grado',      sub:'15 o m√°s dem√©ritos netos ‚Äî consecuencia m√°xima'},
  {min:10, cls:'s-susp',   icon:'‚õî', titulo:'Suspensi√≥n de privilegios',   sub:'10‚Äì14 dem√©ritos netos ‚Äî revisar con direcci√≥n'},
  {min:6,  cls:'s-comms',  icon:'üìû', titulo:'Comunicaci√≥n a la familia',   sub:'6‚Äì9 dem√©ritos netos ‚Äî citar al padre/madre o responsable'},
  {min:3,  cls:'s-warn',   icon:'‚ö°', titulo:'Advertencia formal',           sub:'3‚Äì5 dem√©ritos netos ‚Äî registrar en expediente'},
  {min:0,  cls:'s-none',   icon:'‚úÖ', titulo:'Sin sanci√≥n acumulada',        sub:'0‚Äì2 dem√©ritos netos ‚Äî contin√∫e observando la conducta'},
];

let filaCount = 0;
let estudianteSeleccionado = null;
let _pendingCb = null;

/* ‚îÄ‚îÄ TABLA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function crearFila() {
  filaCount++;
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td class="num">${filaCount}</td>
    <td><input type="date" class="fecha-input"></td>
    <td class="desc"><textarea placeholder="Descripci√≥n‚Ä¶" rows="2"></textarea></td>
    <td class="check-dem"><input type="checkbox" class="dem" data-letra="A" data-desc="No saludar al entrar o al salir del aula."></td>
    <td class="check-dem"><input type="checkbox" class="dem" data-letra="B" data-desc='Omitir "Por favor" al hacer una petici√≥n.'></td>
    <td class="check-dem"><input type="checkbox" class="dem" data-letra="C" data-desc='Omitir "Gracias" al recibir un favor, material o atenci√≥n.'></td>
    <td class="check-dem"><input type="checkbox" class="dem" data-letra="D" data-desc="Usar un tono grosero o irrespetuoso hacia compa√±eros, docentes o personal."></td>
    <td class="check-red"><input type="checkbox" class="red" data-letra="A" data-desc="Cumplir una semana completa con saludos y expresiones de cortes√≠a ejemplares."></td>
    <td class="check-red"><input type="checkbox" class="red" data-letra="B" data-desc="Apoyar voluntariamente en actividades de orden y limpieza escolar."></td>
    <td class="check-red"><input type="checkbox" class="red" data-letra="C" data-desc="Participar en campa√±as de valores organizadas por el centro educativo."></td>
    <td class="check-rec"><input type="checkbox" class="rec" data-letra="A" data-desc="Diplomas."></td>
    <td class="check-rec"><input type="checkbox" class="rec" data-letra="B" data-desc="Menciones en Murales Escolares."></td>
    <td><input type="text" class="inline" placeholder="Nombre docente"></td>
    <td><input type="text" class="inline" placeholder="Firma responsable"></td>
    <td><input type="text" class="inline" placeholder="Firma estudiante"></td>
    <td class="del-cell"><button onclick="eliminarFila(this)" title="Eliminar fila">‚úï</button></td>
  `;
  return tr;
}

function agregarFila() { document.getElementById('tabla').appendChild(crearFila()); }

function eliminarFila(btn) {
  const fila = btn.closest('tr');
  if (document.querySelectorAll('#tabla tr').length <= 1) return;
  fila.style.transition = 'opacity .2s'; fila.style.opacity = '0';
  setTimeout(() => { fila.remove(); recalcular(); renumerarFilas(); }, 200);
}

function renumerarFilas() {
  document.querySelectorAll('#tabla tr').forEach((tr,i) => { const c=tr.querySelector('.num'); if(c) c.textContent=i+1; });
}

function generarTabla(n=12) {
  const tb = document.getElementById('tabla'); tb.innerHTML=''; filaCount=0;
  for(let i=0;i<n;i++) tb.appendChild(crearFila());
}

/* ‚îÄ‚îÄ DESCRIPCI√ìN FILA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function actualizarDescFila(fila) {
  const textarea = fila.querySelector('.desc textarea');
  const lineas = [
    ...[...fila.querySelectorAll('.dem:checked')].map(cb=>`D-${cb.dataset.letra}) ${cb.dataset.desc}`),
    ...[...fila.querySelectorAll('.red:checked')].map(cb=>`R-${cb.dataset.letra}) ${cb.dataset.desc}`),
    ...[...fila.querySelectorAll('.rec:checked')].map(cb=>`RC-${cb.dataset.letra}) ${cb.dataset.desc}`),
  ];
  textarea.value = lineas.join('\n');
}

/* ‚îÄ‚îÄ C√ÅLCULOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function recalcular() {
  const dem = document.querySelectorAll('.dem:checked').length;
  const red = document.querySelectorAll('.red:checked').length;
  const rec = document.querySelectorAll('.rec:checked').length;
  const net = Math.max(0, dem-red);
  document.getElementById('totalDem').textContent = dem;
  document.getElementById('totalRed').textContent = red;
  document.getElementById('totalNet').textContent = net;
  document.getElementById('totalRec').textContent = rec;
  const pct = Math.min(100,(net/15)*100);
  const bar = document.getElementById('progressBar');
  bar.style.width = pct+'%';
  document.getElementById('progressLabel').textContent = `${net} / 15`;
  if(net>=15)      bar.style.background='#c0392b';
  else if(net>=10) bar.style.background='#e74c3c';
  else if(net>=6)  bar.style.background='#e67e22';
  else if(net>=3)  bar.style.background='#f1c40f';
  else             bar.style.background='#27ae60';
  const s = SANCIONES.find(x=>net>=x.min);
  const el = document.getElementById('sancion');
  el.className = `sanction ${s.cls}`;
  el.innerHTML = `<div class="sanction-icon">${s.icon}</div><div class="sanction-text">${s.titulo}<small>${s.sub}</small></div>`;
}

/* ‚îÄ‚îÄ MODALES CONFIRM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function abrirConfirm(tipo, cb) {
  _pendingCb = cb;
  const bodyId    = tipo==='red' ? 'confirmRedBody'    : 'confirmRecBody';
  const overlayId = tipo==='red' ? 'confirmRedOverlay' : 'confirmRecOverlay';
  const letClass  = tipo==='red' ? 'red-theme-letter'  : 'rec-theme-letter';
  document.getElementById(bodyId).innerHTML = `
    <div class="confirm-item">
      <div class="confirm-letter ${letClass}">${cb.dataset.letra}</div>
      <div class="confirm-item-text">${cb.dataset.desc}</div>
    </div>`;
  document.getElementById(overlayId).classList.add('open');
}

function cancelarConfirm(tipo) {
  if(_pendingCb){ _pendingCb.checked=false; _pendingCb=null; }
  document.getElementById(tipo==='red'?'confirmRedOverlay':'confirmRecOverlay').classList.remove('open');
  recalcular();
}

function aceptarConfirm(tipo) {
  document.getElementById(tipo==='red'?'confirmRedOverlay':'confirmRecOverlay').classList.remove('open');
  if(_pendingCb){ actualizarDescFila(_pendingCb.closest('tr')); _pendingCb=null; }
  recalcular();
}

/* ‚îÄ‚îÄ MODAL ESTUDIANTE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function abrirModal() {
  document.getElementById('modalSearch').value='';
  renderLista(ESTUDIANTES);
  document.getElementById('modalOverlay').classList.add('open');
  setTimeout(()=>document.getElementById('modalSearch').focus(),120);
}
function cerrarModal() { document.getElementById('modalOverlay').classList.remove('open'); }
function cerrarModalOverlay(e) { if(e.target===document.getElementById('modalOverlay')) cerrarModal(); }

function filtrarEstudiantes() {
  const q=document.getElementById('modalSearch').value.trim().toLowerCase();
  renderLista(q ? ESTUDIANTES.filter(s=>s.nombre.toLowerCase().includes(q)||s.nie.includes(q)) : ESTUDIANTES);
}

function renderLista(lista) {
  const c=document.getElementById('modalList');
  if(!lista.length){ c.innerHTML='<div class="modal-no-results">üîç No se encontraron resultados</div>'; return; }
  c.innerHTML=lista.map(s=>`
    <div class="modal-item ${estudianteSeleccionado?.nie===s.nie?'selected':''}" onclick="seleccionarEstudiante(${s.no-1})">
      <div class="modal-num">${s.no}</div>
      <div class="modal-info">
        <div class="est-name">${resaltar(s.nombre)}</div>
        <div class="est-nie">NIE: ${resaltar(s.nie)}</div>
      </div>
      <span style="color:#c8a84b;font-size:18px;opacity:${estudianteSeleccionado?.nie===s.nie?'1':'0'}">‚úì</span>
    </div>`).join('');
}

function resaltar(texto) {
  const q=document.getElementById('modalSearch').value.trim();
  if(!q) return texto;
  return texto.replace(new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'gi'),'<mark style="background:#fff3cd;border-radius:2px;padding:0 1px;">$1</mark>');
}

function seleccionarEstudiante(idx) {
  const est=ESTUDIANTES[idx]; estudianteSeleccionado=est;
  const turnoAuto=new Date().getHours()<12?'Matutino':'Vespertino';
  document.getElementById('nombreEstudiante').value=est.nombre;
  document.getElementById('nie').value=est.nie;
  document.getElementById('sexo').value=est.sexo;
  document.getElementById('grado').value='1¬∞ A√±o General';
  document.getElementById('anio').value='2026';
  document.getElementById('turno').value=turnoAuto;
  ['nombreEstudiante','nie','grado','anio'].forEach(id=>{
    const el=document.getElementById(id); el.style.transition='background .15s'; el.style.background='#e8f5e9';
    setTimeout(()=>{ el.style.background=''; },700);
  });
  ['sexo','turno'].forEach(id=>{
    const el=document.getElementById(id); el.style.transition='background .15s'; el.style.background='#e8f5e9';
    setTimeout(()=>{ el.style.background=''; },700);
  });
  guardarDatos(); cerrarModal();
}

/* ‚îÄ‚îÄ PERSISTENCIA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function guardarDatos() {
  try {
    localStorage.setItem('ce_demeritos_estudiante', JSON.stringify({
      nombre: document.getElementById('nombreEstudiante').value,
      nie:    document.getElementById('nie').value,
      sexo:   document.getElementById('sexo').value,
      grado:  document.getElementById('grado').value,
      turno:  document.getElementById('turno').value,
      anio:   document.getElementById('anio').value,
    }));
  } catch(_) {}
}

function cargarDatos() {
  try {
    const raw=localStorage.getItem('ce_demeritos_estudiante'); if(!raw) return;
    const d=JSON.parse(raw);
    document.getElementById('nombreEstudiante').value=d.nombre||'';
    document.getElementById('nie').value=d.nie||'';
    document.getElementById('sexo').value=d.sexo||'';
    document.getElementById('grado').value=d.grado||'';
    document.getElementById('turno').value=d.turno||'';
    document.getElementById('anio').value=d.anio||'';
  } catch(_) {}
}

/* ‚îÄ‚îÄ PDF ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
async function exportarPDF() {
  const btn=document.getElementById('btnPDF');
  btn.disabled=true; btn.innerHTML='‚è≥ Generando‚Ä¶';
  document.querySelectorAll('.del-cell').forEach(c=>c.style.display='none');
  try {
    const canvas=await html2canvas(document.getElementById('contenidoPDF'),{scale:2,useCORS:true,logging:false});
    const {jsPDF}=window.jspdf; const pdf=new jsPDF('p','mm','a4');
    const pw=190, pageH=277, ph=(canvas.height*pw)/canvas.width;
    if(ph<=pageH){ pdf.addImage(canvas.toDataURL('image/png'),'PNG',10,10,pw,ph); }
    else {
      let rem=ph,sy=0;
      while(rem>0){
        const sh=Math.min(rem,pageH),sc=document.createElement('canvas'),r=canvas.width/pw;
        sc.width=canvas.width; sc.height=sh*r;
        sc.getContext('2d').drawImage(canvas,0,sy*r,canvas.width,sc.height,0,0,canvas.width,sc.height);
        if(sy>0) pdf.addPage();
        pdf.addImage(sc.toDataURL('image/png'),'PNG',10,10,pw,sh);
        sy+=sh; rem-=sh;
      }
    }
    const nombre=document.getElementById('nombreEstudiante').value.trim()||'Estudiante';
    pdf.save(`Instrumento_001_${nombre.replace(/\s+/g,'_')}.pdf`);
  } catch(err){ console.error(err); alert('Error al generar PDF.'); }
  finally {
    document.querySelectorAll('.del-cell').forEach(c=>c.style.display='');
    btn.disabled=false; btn.innerHTML='üíæ Guardar PDF';
  }
}

/* ‚îÄ‚îÄ LIMPIAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function limpiarFormulario() {
  if(!confirm('¬øLimpiar todo el formulario? Esta acci√≥n no se puede deshacer.')) return;
  ['nombreEstudiante','nie','grado','anio'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('sexo').value=''; document.getElementById('turno').value='';
  try{ localStorage.removeItem('ce_demeritos_estudiante'); }catch(_){}
  generarTabla(); recalcular();
}

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
document.addEventListener('DOMContentLoaded', ()=>{
  generarTabla(); cargarDatos();

  document.addEventListener('change', e=>{
    if(e.target.matches('.dem,.red,.rec')) recalcular();
    if(e.target.matches('.dem')) actualizarDescFila(e.target.closest('tr'));
    if(e.target.matches('.red')){ if(e.target.checked) abrirConfirm('red',e.target); else actualizarDescFila(e.target.closest('tr')); }
    if(e.target.matches('.rec')){ if(e.target.checked) abrirConfirm('rec',e.target); else actualizarDescFila(e.target.closest('tr')); }
    if(e.target.matches('#nombreEstudiante,#nie,#sexo,#grado,#turno,#anio')) guardarDatos();
  });
  document.addEventListener('input', e=>{ if(e.target.matches('#nombreEstudiante,#nie,#grado,#anio')) guardarDatos(); });
  document.addEventListener('keydown', e=>{
    if(e.key!=='Escape') return;
    if(document.getElementById('modalOverlay').classList.contains('open'))      cerrarModal();
    if(document.getElementById('confirmRedOverlay').classList.contains('open')) cancelarConfirm('red');
    if(document.getElementById('confirmRecOverlay').classList.contains('open')) cancelarConfirm('rec');
  });
  document.getElementById('confirmRedOverlay').addEventListener('click',function(e){ if(e.target===this) cancelarConfirm('red'); });
  document.getElementById('confirmRecOverlay').addEventListener('click',function(e){ if(e.target===this) cancelarConfirm('rec'); });
});
</script>
</body>
</html>
