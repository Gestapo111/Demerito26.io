<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instrumento No. 001 - Tarjeta de Deméritos</title>

<!-- Librerías estables -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f4f6f9}
header{background:#003366;color:white;text-align:center;padding:15px}
.container{width:98%;margin:15px auto;background:white;padding:15px;border-radius:6px}
input,select,textarea{width:100%;font-size:11px;padding:4px}
textarea{height:40px}
table{width:100%;border-collapse:collapse;font-size:11px;margin-top:10px}
th,td{border:1px solid #000;padding:3px;text-align:center}
th{background:#e6e6e6}
button{margin:15px;padding:8px 15px;background:#003366;color:white;border:none;border-radius:4px;cursor:pointer}
.alerta{padding:8px;margin-top:8px;font-weight:bold;text-align:center}
.verde{background:#d4edda}
.amarillo{background:#fff3cd}
.naranja{background:#ffe0b2}
.rojo{background:#f8d7da}
.total-box{font-weight:bold;padding:6px;margin-top:6px}
</style>
</head>

<body>

<header>
<h2>Instrumento No. 001</h2>
<h3>Tarjeta de Deméritos del Estudiante</h3>
</header>

<div class="container" id="contenidoPDF">

<table>
<tr>
<td>Centro Educativo</td>
<td colspan="3"><input value="COMPLEJO EDUCATIVO CANTÓN SAN ISIDRO" readonly></td>
<td>Código C.E.</td>
<td><input value="70056" readonly></td>
</tr>
<tr>
<td>Departamento</td><td><input value="SAN SALVADOR" readonly></td>
<td>Municipio</td><td><input value="PANCHIMALCO" readonly></td>
<td>Distrito</td><td><input value="06-14" readonly></td>
</tr>
<tr>
<td>Nombre del Estudiante</td>
<td colspan="3"><input></td>
<td>NIE</td>
<td><input></td>
</tr>
<tr>
<td>Sexo</td>
<td>
<select>
<option></option>
<option>Mujer</option>
<option>Hombre</option>
</select>
</td>
<td>Grado/Sección</td><td><input></td>
<td>Turno</td>
<td>
<select>
<option></option>
<option>Matutino</option>
<option>Vespertino</option>
<option>Nocturno</option>
</select>
</td>
</tr>
</table>

<table>
<tr>
<th>No.</th>
<th>Fecha</th>
<th colspan="4">Deméritos</th>
<th colspan="3">Redención</th>
<th colspan="2">Reconocimientos</th>
<th>Quien registra</th>
<th>Responsable</th>
<th>Firma estudiante</th>
</tr>

<tr>
<th></th><th></th>
<th>A</th><th>B</th><th>C</th><th>D</th>
<th>A</th><th>B</th><th>C</th>
<th>A</th><th>B</th>
<th></th><th></th><th></th>
</tr>

<tbody id="tabla"></tbody>

<tr>
<td colspan="14" class="total-box">
Total Deméritos: <span id="total">0</span>
</td>
</tr>
</table>

<div id="alerta" class="alerta verde">Sin sanción acumulada</div>

<p><strong>Nombre, firma y sello del Director</strong></p>

</div>

<div style="text-align:center">
<button onclick="exportarPDF()">Guardar en PDF</button>
</div>

<script>

for(let i=1;i<=8;i++){
document.getElementById("tabla").innerHTML+=`
<tr>
<td>${i}</td>
<td><input type="date"></td>

<td><input type="checkbox" class="dem"></td>
<td><input type="checkbox" class="dem"></td>
<td><input type="checkbox" class="dem"></td>
<td><input type="checkbox" class="dem"></td>

<td><input type="checkbox" class="red"></td>
<td><input type="checkbox" class="red"></td>
<td><input type="checkbox" class="red"></td>

<td><input type="checkbox" class="rec"></td>
<td><input type="checkbox" class="rec"></td>

<td><textarea></textarea></td>
<td><textarea></textarea></td>
<td><textarea></textarea></td>
</tr>`;
}

document.addEventListener("change",calcular);

function calcular(){
let dem=document.querySelectorAll(".dem:checked").length;
let red=document.querySelectorAll(".red:checked").length;

let total=dem-red;
if(total<0) total=0;

document.getElementById("total").innerText=total;

let alerta=document.getElementById("alerta");
alerta.className="alerta";

if(total>=15){alerta.innerHTML="15 DEMÉRITOS: No promoción de grado";alerta.classList.add("rojo");}
else if(total>=10){alerta.innerHTML="10 DEMÉRITOS: Suspensión de privilegios";alerta.classList.add("naranja");}
else if(total>=6){alerta.innerHTML="6 DEMÉRITOS: Comunicación a la familia";alerta.classList.add("amarillo");}
else if(total>=3){alerta.innerHTML="3 DEMÉRITOS: Advertencia verbal";alerta.classList.add("amarillo");}
else{alerta.innerHTML="Sin sanción acumulada";alerta.classList.add("verde");}
}

async function exportarPDF(){

const { jsPDF } = window.jspdf;

const elemento = document.getElementById("contenidoPDF");

const canvas = await html2canvas(elemento,{scale:2});
const imgData = canvas.toDataURL("image/png");

const pdf = new jsPDF('p','mm','a4');

const imgWidth = 190;
const pageHeight = 297;
const imgHeight = canvas.height * imgWidth / canvas.width;

let heightLeft = imgHeight;
let position = 10;

pdf.addImage(imgData,'PNG',10,position,imgWidth,imgHeight);
heightLeft -= pageHeight;

while (heightLeft >= 0) {
position = heightLeft - imgHeight;
pdf.addPage();
pdf.addImage(imgData,'PNG',10,position,imgWidth,imgHeight);
heightLeft -= pageHeight;
}

pdf.save("Instrumento_001_Demeritos_CE_San_Isidro.pdf");

}

</script>

</body>
</html>
