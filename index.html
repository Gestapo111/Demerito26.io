<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Instrumento No. 001</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

body{
font-family:'Segoe UI',sans-serif;
background:#eef2f7;
margin:0;
}

.documento{
width:210mm;
min-height:297mm;
background:white;
margin:auto;
padding:20px;
box-shadow:0 0 15px rgba(0,0,0,0.15);
}

.encabezado{
display:flex;
justify-content:space-between;
align-items:center;
border-bottom:3px solid #003366;
padding-bottom:10px;
}

.titulo{
text-align:center;
flex-grow:1;
}

.titulo h2{
margin:0;
color:#003366;
}

.subtitulo{
font-size:14px;
}

.seccion{
margin-top:15px;
}

table{
width:100%;
border-collapse:collapse;
font-size:11px;
}

th,td{
border:1px solid #444;
padding:4px;
text-align:center;
}

th{
background:#003366;
color:white;
}

input,select,textarea{
width:100%;
border:none;
font-size:11px;
padding:3px;
}

.panel{
display:flex;
justify-content:space-between;
margin-top:10px;
}

.card{
padding:10px;
border-radius:8px;
font-weight:bold;
color:white;
}

.total{background:#003366;}
.alerta{background:#28a745;}

button{
margin:15px;
padding:10px 20px;
background:#003366;
color:white;
border:none;
border-radius:6px;
cursor:pointer;
}

</style>
</head>

<body>

<div id="contenidoPDF" class="documento">

<div class="encabezado">
<div></div>

<div class="titulo">
<h2>Instrumento No. 001</h2>
<div class="subtitulo">Tarjeta de Deméritos del Estudiante</div>
</div>

<div></div>
</div>

<!-- DATOS -->
<div class="seccion">
<table>
<tr>
<td>Centro Educativo</td>
<td colspan="3"><input value="COMPLEJO EDUCATIVO CANTÓN SAN ISIDRO" readonly></td>
<td>Código</td>
<td><input value="70056" readonly></td>
</tr>

<tr>
<td>Departamento</td>
<td><input value="SAN SALVADOR" readonly></td>
<td>Municipio</td>
<td><input value="PANCHIMALCO" readonly></td>
<td>Distrito</td>
<td><input value="06-14" readonly></td>
</tr>

<tr>
<td>Estudiante</td>
<td colspan="3"><input></td>
<td>NIE</td>
<td><input></td>
</tr>

<tr>
<td>Sexo</td>
<td>
<select><option></option><option>Mujer</option><option>Hombre</option></select>
</td>
<td>Grado/Sección</td>
<td><input></td>
<td>Turno</td>
<td>
<select><option></option><option>Matutino</option><option>Vespertino</option><option>Nocturno</option></select>
</td>
</tr>
</table>
</div>

<!-- TABLA -->
<div class="seccion">
<table>

<tr>
<th>No.</th>
<th>Fecha</th>
<th colspan="4">D</th>
<th colspan="3">R</th>
<th colspan="2">RC</th>
<th>Docente</th>
<th>Responsable</th>
<th>Estudiante</th>
</tr>

<tr>
<th></th><th></th>
<th>A</th><th>B</th><th>C</th><th>D</th>
<th>A</th><th>B</th><th>C</th>
<th>A</th><th>B</th>
<th></th><th></th><th></th>
</tr>

<tbody id="tabla"></tbody>

</table>
</div>

<!-- PANEL -->
<div class="panel">
<div class="card total">
Total Deméritos: <span id="total">0</span>
</div>

<div class="card alerta" id="alerta">
Sin sanción acumulada
</div>
</div>

<p><strong>Nombre, firma y sello del Director del C.E.</strong></p>

</div>

<div style="text-align:center">
<button onclick="exportarPDF()">Guardar en PDF</button>
</div>

<script>

for(let i=1;i<=8;i++){
tabla.innerHTML+=`
<tr>
<td>${i}</td>
<td><input type="date"></td>

<td><input type="checkbox" class="dem"></td>
<td><input type="checkbox" class="dem"></td>
<td><input type="checkbox" class="dem"></td>
<td><input type="checkbox" class="dem"></td>

<td><input type="checkbox" class="red"></td>
<td><input type="checkbox" class="red"></td>
<td><input type="checkbox" class="red"></td>

<td><input type="checkbox" class="rec"></td>
<td><input type="checkbox" class="rec"></td>

<td><textarea></textarea></td>
<td><textarea></textarea></td>
<td><textarea></textarea></td>
</tr>`;
}

document.addEventListener("change",()=>{

let dem=document.querySelectorAll(".dem:checked").length;
let red=document.querySelectorAll(".red:checked").length;

let total=dem-red;
if(total<0) total=0;

totalSpan=total;
document.getElementById("total").innerText=total;

let alerta=document.getElementById("alerta");

if(total>=15){alerta.innerHTML="No promoción de grado";alerta.style.background="#dc3545";}
else if(total>=10){alerta.innerHTML="Suspensión de privilegios";alerta.style.background="#fd7e14";}
else if(total>=6){alerta.innerHTML="Comunicación a la familia";alerta.style.background="#ffc107";}
else if(total>=3){alerta.innerHTML="Advertencia verbal";alerta.style.background="#ffc107";}
else{alerta.innerHTML="Sin sanción acumulada";alerta.style.background="#28a745";}

});

async function exportarPDF(){

const canvas=await html2canvas(document.getElementById("contenidoPDF"),{scale:2});
const img=canvas.toDataURL("image/png");

const {jsPDF}=window.jspdf;
const pdf=new jsPDF('p','mm','a4');

pdf.addImage(img,'PNG',10,10,190,0);
pdf.save("Instrumento_001.pdf");

}

</script>

</body>
</html>
